<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Prototype Unit test file</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <script type="text/javascript" charset="utf-8">
    var originalElement = Element;
  </script>
  <script src="../../dist/prototype.js" type="text/javascript"></script>
  <script src="../lib/unittest.js" type="text/javascript"></script>
  <link rel="stylesheet" href="../test.css" type="text/css" />
  <style type="text/css" media="screen">
  /* <![CDATA[ */
    #dimensions_test_1 {
      width: 200px;
      height: 200px;
      padding: 5px 10px;
      margin: 12px;
      border: 4px solid #039;
    }
    
    #dimensions_test_2 {
      position: absolute;
      top: 21px;
      left: 41px;
      width: 200px;
      height: 200px;
      padding: 5px 10px;
      margin: 12px;
      border: 4px solid #039;
    }    
  
    #style_test_1 { cursor: pointer; font-size:12px;}
    div.style-test { margin-left: 1px }
    
    #style_test_dimensions_container { 
      position: absolute;
      top: 0;
      left: 500px;
      width: 20px;
      height: 30px;
      margin: 10px;
      padding: 10px;
      border: 3px solid red;
    }
    
    #not_floating_style { float: none }
    #floating_style { float: left }
    #op2 { opacity:0.5;filter:alpha(opacity=50)progid:DXImageTransform.Microsoft.Blur(strength=10);}
    
    #scroll_test_1 { 
      margin: 10px;
      padding: 10px;
      position: relative;
    }
    
    #scroll_test_2 {
      position: absolute;
      left: 10px;
      top: 10px;
    }
    
    #dimensions-visible,
    #dimensions-display-none,
    #dimensions-visible-pos-rel,
    #dimensions-display-none-pos-rel,
    #dimensions-visible-pos-abs,
    #dimensions-display-none-pos-abs {
        font-size: 10px;
        height: 10em;
        width: 20em;
    }
    
    #dimensions-visible-pos-abs,
    #dimensions-display-none-pos-abs {
      position: absolute;
      top: 15px;
      left: 15px;
    }
    
    #dimensions-visible-pos-rel,
    #dimensions-display-none-pos-rel {
      position: relative;
      top: 15px;
      left: 15px;
    }
    
    #dimensions-display-none, #imensions-display-none-pos-rel, #dimensions-display-none-pos-abs {
        display: none;
    }
    
    #dimensions-table, #dimensions-tbody, #dimensions-tr, #dimensions-td {
        font-size: 10px;
        margin: 0;
        padding: 0;
        border: 0;
        border-spacing: 0;
        height: 10em;
        width: 20em;
    }

    #notInlineAbsoluted { position: absolute; }
    
    #elementToViewportDimensions {
      position: absolute;
      top: 0;
      left: 0;
      height: 10px;
      width: 10px;
      background: #000;
    }
    
    /* for scroll test on really big screens */
    body {
      height: 40000px;
    }
  /* ]]> */
  </style>
</head>
<body>
<h1>Prototype Unit test file</h1>
<p>
  Test of functions in dom.js
</p>

<!-- Log output -->
<div id="scroll_test_1">
  <p id="scroll_test_2">Scroll test</p>
</div>

<div id="testlog"> </div>


<div id="dimensions_test_1">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</div>

<div id="dimensions_test_2">Lorem ipsum dolor sit amet.</div>

<div id="test-visible">visible</div>
<div id="test-hidden" style="display:none;">hidden</div>
<div id="test-toggle-visible">visible</div>
<div id="test-toggle-hidden" style="display:none;">hidden</div>
<div id="test-hide-visible">visible</div>
<div id="test-hide-hidden" style="display:none;">hidden</div>
<div id="test-show-visible">visible</div>
<div id="test-show-hidden" style="display:none;">hidden</div>
<div id="removable-container"><div id="removable"></div></div>

<div>
  <table>
    <tbody id="table">
      <tr>
        <td>Data</td>
      </tr>
      <tr>
        <td id="a_cell">First Row</td>
      </tr>
      <tr id="second_row">
        <td>Second Row</td>
      </tr>
    </tbody>
  </table>
</div>

<div id="table-container-to-replace">
  <table>
    <tbody id="table-to-replace">
      <tr>
        <td>Data</td>
      </tr>
      <tr>
        <td id="a_cell-to-replace">First Row</td>
      </tr>
      <tr id="second_row-to-replace">
        <td>Second Row</td>
      </tr>
    </tbody>
  </table>
</div>

<p class="test">Test paragraph outside of container</p>

<div id="container">
  <p class="test" id="intended">Test paragraph 1 inside of container</p>
  <p class="test">Test paragraph 2 inside of container</p>
  <p class="test">Test paragraph 3 inside of container</p>
  <p class="test">Test paragraph 4 inside of container</p>
</div>

<div id="testdiv">to be updated</div>
<div id="testdiv-replace-container-1"><div id="testdiv-replace-1"></div></div>
<div id="testdiv-replace-container-2"><div id="testdiv-replace-2"></div></div>
<div id="testdiv-replace-container-3"><div id="testdiv-replace-3"></div></div>
<div id="testdiv-replace-container-4"><div id="testdiv-replace-4"></div></div>
<div id="testdiv-replace-container-5"><div id="testdiv-replace-5"></div></div>
<div id="testdiv-replace-container-element"><div id="testdiv-replace-element"></div></div>
<div id="testdiv-replace-container-toelement"><div id="testdiv-replace-toelement"></div></div>
<div id="testdiv-replace-container-tohtml"><div id="testdiv-replace-tohtml"></div></div>
<div id="testtable-replace-container"><table id="testtable-replace"></table></div>
<table id="testrow-replace-container"><tr id="testrow-replace"></tr></table>
<select id="testoption-replace-container"><option id="testoption-replace"></option><option>stays</option></select>
<div id="testform-replace-container"><p>some text</p><form id="testform-replace"><input id="testinput-replace" type="text" /></form><p>some text</p></div>

<div id="element_with_visible_overflow" style="overflow:visible">V</div>
<div id="element_with_hidden_overflow" style="overflow:hidden">H</div>
<div id="element_with_scroll_overflow" style="overflow:scroll">S</div>

<div id="element_extend_test"> </div>

<div id="element_reextend_test"><div id="discard_1"></div></div>

<div id="test_whitespace"> <span> </span>


<div><div></div> </div><span> </span>
</div>


<div id="nav_tests_isolator">
  <div id="nav_test_first_sibling"></div>
  <div></div>
  <p id="nav_test_p" class="test"></p>
  <span id="nav_test_prev_sibling"></span>
  
  <ul id="navigation_test" style="display: none">
    <!-- comment node to screw things up -->
    <li class="first"><em>A</em></li>
    <li><em class="dim">B</em></li>
    <li id="navigation_test_c">
    <em>C</em>
    <ul>
      <li><em class="dim">E</em></li>
      <li id="navigation_test_f"><em>F</em></li>
    </ul>
    </li>
    <li class="last"><em>D</em></li>
  </ul>
  
  <div id="navigation_test_next_sibling">
    <!-- -->
  </div>
  
  <p></p>
</div>

<div id="class_names">
  <p class="A"></p>
  <ul class="A B" id="class_names_ul">
    <li class="C"></li>
    <li class="A C"></li>
    <li class="1"></li>
  </ul>
  <div class="B C D"></div>
  <div id="unextended"></div>
</div>

<div id="style_test_1" style="display:none;"></div>
<div id="style_test_2" class="style-test" style="font-size:11px;"></div>

<div id="style_test_3">blah</div>
<span id="style_test_4">blah</span>
<span id="style_test_5">blah</span>

<div id="style_test_dimensions_container">
  <div id="style_test_dimensions" style="background:#ddd;padding:1px;margin:1px;border:1px solid #00f"><div style="height:5px;background:#eee;width:5px;padding:2px;margin:2px;border:2px solid #0f0"> </div>
  </div>
</div>

<div id="test_csstext_1">test_csstext_1</div>
<div id="test_csstext_2">test_csstext_2</div>
<div id="test_csstext_3" style="border: 1px solid red">test_csstext_3</div>
<div id="test_csstext_4" style="font-size: 20px">test_csstext_4</div>
<div id="test_csstext_5">test_csstext_5</div>

<div id="custom_attributes">
  <div foo="1" bar="2"></div>
  <div foo="2"></div>
</div>

<div id="cloned_element_attributes_issue" foo="original"></div>
<a id="attributes_with_issues_1" href="test.html" accesskey="L" tabindex="50" title="a link" onclick="alert('hello world');"></a>
<a id="attributes_with_issues_2" href="" accesskey="" tabindex="" title=""></a>
<a id="attributes_with_issues_3"></a>
<form id="attributes_with_issues_form" method="post" action="blah">
  <input type="checkbox" id="attributes_with_issues_checked" name="a" checked="checked"/>
  <input type="checkbox" id="attributes_with_issues_disabled" name="b" checked="checked" disabled="disabled"/>
  <input type="text" id="attributes_with_issues_readonly" name="c" readonly="readonly" value="blech"/>
  <input type="date" id="attributes_with_issues_type" value="blech" />
  <select id="attributes_with_issues_multiple" name="e" multiple="multiple">
    <option>blech</option>
    <option>blah</option>
  </select>
</form>

<!-- writeAttributes  -->
<p id="write_attribute_para"></a>
<a id="write_attribute_link" href="test.html"></a>
<form action="/dev/null" id="write_attribute_form" method="get" accept-charset="utf-8">
  <label id="write_attribute_label"></label>
  <input type="checkbox" name="write_attribute_checkbox" value="" id="write_attribute_checkbox">
  <input type="checkbox" checked="checked" name="write_attribute_checked_checkbox" value="" id="write_attribute_checked_checkbox">
  <input type="text" name="write_attribute_input" value="" id="write_attribute_input">
  <select id="write_attribute_select">
    <option>Cat</option>
    <option>Dog</option>
  </select>
</form>

<table id="write_attribute_table" cellpadding="6" cellspacing="4">
  <tr><td id="write_attribute_td">A</td><td>B</td></tr>
  <tr><td>C</td></tr>
  <tr><td>D</td><td>E</td><td>F</td></tr>
</table>

<div id="dom_attribute_precedence">
  <form action="blech" method="post">
    <input type="submit" id="update" />
  </form>
</div>

<div id="not_floating_none">NFN</div>
<div id="not_floating_inline" style="float:none">NFI</div>
<div id="not_floating_style">NFS</div>

<div id="floating_inline" style="float:left">FI</div>
<div id="floating_style">FS</div>
<!-- Test Element opacity functions -->
<img id="op1" alt="op2" src="fixtures/logo.gif" style="opacity:0.5;filter:alpha(opacity=50)" />
<img id="op2" alt="op2" src="fixtures/logo.gif"/>
<img id="op3" alt="op3" src="fixtures/logo.gif"/>
<img id="op4-ie" alt="op3" src="fixtures/logo.gif" style="filter:alpha(opacity=30)" />
<div id="dimensions-visible"></div>
<div id="dimensions-display-none"></div>
<div id="dimensions-visible-pos-rel"></div>
<div id="dimensions-display-none-pos-rel"></div>
<div id="dimensions-visible-pos-abs"></div>
<div id="dimensions-display-none-pos-abs"></div>
<table border="0" cellspacing="0" cellpadding="0" id="dimensions-table">
  <tbody id="dimensions-tbody">
    <tr id="dimensions-tr">
      <td id="dimensions-td">Data</td>
    </tr>
  </tbody>
</table>

<div id="dimensions-nester" style="width: 500px;">
  <div id="dimensions-nestee" style="display: none">This is a nested DIV. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</div>
</div>
	

<p id="test-empty"></p>
<p id="test-empty-but-contains-whitespace">  
   
    
</p>
<p id="test-full">content</p>
<div id="ancestor">
  <div id="child">
    <div id="grand-child">
      <div id="great-grand-child"></div>
    </div></div><!-- intentional formatting; don't change this line -->
  <div id="sibling"><div id="grand-sibling"></div></div>
</div>
<div id="not-in-the-family"></div>

<div id="insertions-container"><div id="insertions-main"><p>some content.</p></div></div>
<div id="insertions-node-container"><div id="insertions-node-main"><p>some content.</p></div></div>
<div id="element-insertions-container"><div id="element-insertions-main"><p>some content.</p></div></div>
<div id="element-insertions-multiple-container"><div id="element-insertions-multiple-main"><p>some content.</p></div></div>
<table id="table_for_insertions"></table>
<table id="table_for_row_insertions"><tr id="row_1"></tr></table>
<form method="post" action="blah">
  <select id="select_for_update" name="select_for_update">
    <option>option 1</option>
    <option>option 2</option>
  </select>
  <select id="select_for_insert_bottom" name="select_for_insert_bottom">
    <option>option 1</option>
    <option>option 2</option>
  </select>
  <select id="select_for_insert_top" name="select_for_insert_top">
    <option>option 1</option>
    <option>option 2</option>
  </select>
</form>
<div id="wrap-container"><p id="wrap"></p></div>

<!-- Positioning methods bench -->
<div id="body_absolute" style="position: absolute; top: 10px; left: 10px">
  <div id="absolute_absolute" style="position: absolute; top: 10px; left:10px"> </div>
  <div id="absolute_relative" style="position: relative; top: 10px; left:10px">
    <div style="height:10px;font-size:2px">test<span id="inline">test</span></div>
    <div id="absolute_relative_undefined">XYZ</div>
  </div>
  <div id="absolute_fixed" style="position: fixed; top: 10px; left: 10px">
    <span id="absolute_fixed_absolute" style="position: absolute; top: 10px; left: 10px">foo</span>
    <span id="absolute_fixed_undefined" style="display:block">bar</span>
  </div></div>
<div id="notInlineAbsoluted"></div>
<div id="inlineAbsoluted" style="position: absolute"></div>

<div id="unextended"></div>
<div id="identification">
  <div id="predefined_id"></div>
  <div></div>
  <div></div>
  <div></div>
  <div id="anonymous_element_3"></div>
</div>

<div id='elementToViewportDimensions' style='display: none'></div>

<!-- Tests follow -->
<script type="text/javascript" language="javascript" charset="utf-8">
// <![CDATA[

  var testVar = 'to be updated', testVar2 = '';
  var getInnerHTML = function(id) {
    return $(id).innerHTML.toString().toLowerCase().gsub(/[\r\n\t]/, '');
  };
  var createParagraph = function(text) {
    var p = document.createElement('p');
    p.appendChild(document.createTextNode(text));
    return p;
  }
  Element.addMethods({
    hashBrowns: function(element) { return 'hash browns'; }
  });

  Element.addMethods("LI", {
    pancakes: function(element) { return "pancakes"; }
  });
  
  Element.addMethods("DIV", {
    waffles: function(element) { return "waffles"; }
  });
  
  Element.addMethods($w("li div"), {
    orangeJuice: function(element) { return "orange juice"; }
  });
  
  // Based on properties check from http://www.quirksmode.org/viewport/compatibility.html
  var documentViewportProperties = {
    properties : [
      'self.pageXOffset', 'self.pageYOffset',
      'self.screenX', 'self.screenY',
      'self.innerHeight', 'self.innerWidth',
      'self.outerHeight', 'self.outerWidth',
      'self.screen.height', 'self.screen.width',
      'self.screen.availHeight', 'self.screen.availWidth',
      'self.screen.availTop', 'self.screen.availLeft',
      'self.screen.Top', 'self.screen.Left', 
      'self.screenTop', 'self.screenLeft',
      'document.body.clientHeight', 'document.body.clientWidth',
      'document.body.scrollHeight', 'document.body.scrollWidth',
      'document.body.scrollLeft', 'document.body.scrollTop',
      'document.body.offsetHeight', 'document.body.offsetWidth',
      'document.body.offsetTop', 'document.body.offsetLeft'
    ].inject([], function(properties, prop) {
      if(!self.screen && prop.include('self.screen')) return;
      if (!document.body && prop.include('document.body')) return;
      properties.push(prop);
      if (prop.include('.body') && document.documentElement)
        properties.push(prop.sub('.body', '.documentElement'));
      return properties;
    }),

    inspect : function() {
      var props = [];
      this.properties.each(function(prop) {
        if (eval(prop)) props[prop] = eval(prop);
      }, this);
      return props;
    }
  };

  new Test.Unit.Runner({

    testMakeClipping: function() {
      var chained = Element.extend(document.createElement('DIV'));
      this.assertEqual(chained, chained.makeClipping());
      this.assertEqual(chained, chained.makeClipping());
      this.assertEqual(chained, chained.makeClipping().makeClipping());
      
      this.assertEqual(chained, chained.undoClipping());
      this.assertEqual(chained, chained.undoClipping());
      this.assertEqual(chained, chained.undoClipping().makeClipping());
      
      ['hidden','visible','scroll'].each( function(overflowValue) {
        var element = $('element_with_'+overflowValue+'_overflow');
        
        this.assertEqual(overflowValue, element.getStyle('overflow'));
        element.makeClipping();
        this.assertEqual('hidden', element.getStyle('overflow'));
        element.undoClipping();
        this.assertEqual(overflowValue, element.getStyle('overflow'));
      }, this);
    },
    

    testElementGetHeight: function() {
      this.assertIdentical(100, $('dimensions-visible').getHeight());
      this.assertIdentical(100, $('dimensions-display-none').getHeight());
    },
    
    testElementGetWidth: function() {
      this.assertIdentical(200, $('dimensions-visible').getWidth());
      this.assertIdentical(200, $('dimensions-display-none').getWidth());
    },

    testElementScrollTo: function() {
      var elem = $('scroll_test_2');
      Element.scrollTo('scroll_test_2');
      this.assertEqual(elem.viewportOffset().top, 0);
      window.scrollTo(0, 0);
      
      elem.scrollTo();
      this.assertEqual(elem.viewportOffset().top, 0);
      window.scrollTo(0, 0);
    },
        
    testElementGetDimensions: function() {
      this.assertIdentical(100, $('dimensions-visible').getDimensions().height);
      this.assertIdentical(200, $('dimensions-visible').getDimensions().width);
      this.assertIdentical(100, $('dimensions-display-none').getDimensions().height);
      this.assertIdentical(200, $('dimensions-display-none').getDimensions().width);
      
      this.assertIdentical(100, $('dimensions-visible-pos-rel').getDimensions().height);
      this.assertIdentical(200, $('dimensions-visible-pos-rel').getDimensions().width);
      this.assertIdentical(100, $('dimensions-display-none-pos-rel').getDimensions().height);
      this.assertIdentical(200, $('dimensions-display-none-pos-rel').getDimensions().width);
      
      this.assertIdentical(100, $('dimensions-visible-pos-abs').getDimensions().height);
      this.assertIdentical(200, $('dimensions-visible-pos-abs').getDimensions().width);
      this.assertIdentical(100, $('dimensions-display-none-pos-abs').getDimensions().height);
      this.assertIdentical(200, $('dimensions-display-none-pos-abs').getDimensions().width);
      
      // known failing issue
      // this.assert($('dimensions-nestee').getDimensions().width <= 500, 'check for proper dimensions of hidden child elements');
      
      $('dimensions-td').hide();
      this.assertIdentical(100, $('dimensions-td').getDimensions().height);
      this.assertIdentical(200, $('dimensions-td').getDimensions().width);
      $('dimensions-td').show();
      
      $('dimensions-tr').hide();
      this.assertIdentical(100, $('dimensions-tr').getDimensions().height);
      this.assertIdentical(200, $('dimensions-tr').getDimensions().width);
      $('dimensions-tr').show();
      
      $('dimensions-table').hide();
      this.assertIdentical(100, $('dimensions-table').getDimensions().height);
      this.assertIdentical(200, $('dimensions-table').getDimensions().width);
    },

    testPositionedOffset: function() {
      this.assertEnumEqual([10,10],
        $('body_absolute').positionedOffset());
      this.assertEnumEqual([10,10],
        $('absolute_absolute').positionedOffset());
      this.assertEnumEqual([10,10],
        $('absolute_relative').positionedOffset());
      this.assertEnumEqual([0,10],
        $('absolute_relative_undefined').positionedOffset());
      this.assertEnumEqual([10,10],
        $('absolute_fixed_absolute').positionedOffset());
        
      var afu = $('absolute_fixed_undefined');
      this.assertEnumEqual([afu.offsetLeft, afu.offsetTop],
        afu.positionedOffset());
        
      var element = new Element('div'), offset = element.positionedOffset();
      this.assertEnumEqual([0,0], offset);
      this.assertIdentical(0, offset.top);
      this.assertIdentical(0, offset.left);
    },
    
    testCumulativeOffset: function() {
      var element = new Element('div'), offset = element.cumulativeOffset();
      this.assertEnumEqual([0,0], offset);
      this.assertIdentical(0, offset.top);
      this.assertIdentical(0, offset.left);
    },
    
    testViewportOffset: function() {
      this.assertEnumEqual([10,10],
        $('body_absolute').viewportOffset());
      this.assertEnumEqual([20,20],
        $('absolute_absolute').viewportOffset());
      this.assertEnumEqual([20,20],
        $('absolute_relative').viewportOffset());
      this.assertEnumEqual([20,30],
        $('absolute_relative_undefined').viewportOffset());
      var element = new Element('div'), offset = element.viewportOffset();
      this.assertEnumEqual([0,0], offset);
      this.assertIdentical(0, offset.top);
      this.assertIdentical(0, offset.left);
    },
    
    testOffsetParent: function() {
      this.assertEqual('body_absolute', $('absolute_absolute').getOffsetParent().id);
      this.assertEqual('body_absolute', $('absolute_relative').getOffsetParent().id);
      this.assertEqual('absolute_relative', $('inline').getOffsetParent().id);
      this.assertEqual('absolute_relative', $('absolute_relative_undefined').getOffsetParent().id);
      
      this.assertEqual(document.body, new Element('div').getOffsetParent());
    },

    testAbsolutize: function() {
      $('notInlineAbsoluted', 'inlineAbsoluted').each(function(elt) {
        if ('_originalLeft' in elt) delete elt._originalLeft;
        elt.absolutize();
        this.assertUndefined(elt._originalLeft, 'absolutize() did not detect absolute positioning');
      }, this);
      // invoking on "absolute" positioned element should return element 
      var element = $('absolute_fixed_undefined').setStyle({position: 'absolute'});
      this.assertEqual(element, element.absolutize());
    },
    
    testRelativize: function() {
      // invoking on "relative" positioned element should return element
      var element = $('absolute_fixed_undefined').setStyle({position: 'relative'});
      this.assertEqual(element, element.relativize());
    },
    
    testViewportDimensions: function() {
      preservingBrowserDimensions(function() {
        window.resizeTo(800, 600);
        var before = document.viewport.getDimensions();
        window.resizeBy(50, 50);
        var after  = document.viewport.getDimensions();
      
        this.assertEqual(before.width + 50, after.width, "NOTE: YOU MUST ALLOW JAVASCRIPT TO RESIZE YOUR WINDOW FOR THIS TEST TO PASS");
        this.assertEqual(before.height + 50, after.height, "NOTE: YOU MUST ALLOW JAVASCRIPT TO RESIZE YOUR WINDOW FOR THIS TEST TO PASS");
      }.bind(this));
    },
    
    testElementToViewportDimensionsDoesNotAffectDocumentProperties: function() {
      // No properties on the document should be affected when resizing
      // an absolute positioned(0,0) element to viewport dimensions
      var vd = document.viewport.getDimensions();

      var before = documentViewportProperties.inspect();
      $('elementToViewportDimensions').setStyle({ height: vd.height + 'px', width: vd.width + 'px' }).show();
      var after = documentViewportProperties.inspect();
      $('elementToViewportDimensions').hide();

      documentViewportProperties.properties.each(function(prop) {
        this.assertEqual(before[prop], after[prop], prop + ' was affected');
      }, this);
    },

    testViewportScrollOffsets: function() {
      preservingBrowserDimensions(function() {
        window.scrollTo(0, 0);
        this.assertEqual(0, document.viewport.getScrollOffsets().top);
      
        window.scrollTo(0, 35);
        this.assertEqual(35, document.viewport.getScrollOffsets().top);
      
        window.resizeTo(200, 650);
        window.scrollTo(25, 35);
        this.assertEqual(25, document.viewport.getScrollOffsets().left, "NOTE: YOU MUST ALLOW JAVASCRIPT TO RESIZE YOUR WINDOW FOR THESE TESTS TO PASS");
      
        window.resizeTo(850, 650);
      }.bind(this));
    },
    
    
    testDimensions: function() {
      var d = $('dimensions_test_1').getDimensions();

      this.assertEqual(200, d.contentBox.width, 'content box width');
      this.assertEqual(220, d.paddingBox.width, 'padding box width');
      this.assertEqual(228, d.borderBox.width,  'border box width');
      
      this.assertEqual(d.contentBox.height,
       d.paddingBox.height - d.padding.top - d.padding.bottom,
       "content box height, padding box height");
      
      this.assertEqual(4,  d.border.left,  'border left');
      this.assertEqual(10, d.padding.left, 'padding left');
      this.assertEqual(5,  d.padding.top,  'padding top');
      
      // TODO: Relative measurements
      
    },
    
    testOffsets: function() {
      var d = $('dimensions_test_2');
      
      this.assertEnumEqual([53, 33], d.cumulativeOffset(), 'cumulative offset');
      
      window.scrollTo(0, 0);      
      this.assertEnumEqual(d.cumulativeOffset(), d.viewportOffset(), 'viewport offset');
      
      window.scrollTo(0, 250);
      this.assertEnumEqual([53, -217], d.viewportOffset(), 'scrolled viewport offset');
    }
    
    // TODO: Offset tests
  });

  function preservingBrowserDimensions(callback) {
    var original = document.viewport.getDimensions();
    window.resizeTo(640, 480);
    var resized = document.viewport.getDimensions();
    original.width += 640 - resized.width, original.height += 480 - resized.height;
    
    try {
      window.resizeTo(original.width, original.height);
      callback();
    } finally {
      window.resizeTo(original.width, original.height);
    }
  }

// ]]>
</script>
</body>
</html>
